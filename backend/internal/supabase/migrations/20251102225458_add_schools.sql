-- remove in prod! this is only to make sure the seed data is present for testing
INSERT INTO "public"."therapist" ("id", "first_name", "last_name", "email", "active", "created_at", "updated_at") VALUES ('3a0b0e42-b8f2-4ec4-8749-9f13f1f776c1', 'Melody', 'Yu', 'yu.melo@northeastern.edu', 'true', '2025-10-05 22:56:02.141816+00', '2025-10-05 22:56:02.141816+00'), ('4a9a4e58-ea6c-496a-915f-3e8214e77112', 'Poop', 'Matula', 'matulakevin91@gmail.com', 'true', '2025-09-14 05:35:12.896354+00', '2025-09-14 14:04:21.037169+00'), ('5bbefb2e-5d1c-4fb8-98da-6cf02996aaa7', 'A', 'D', 'a@gmail.com', 'true', '2025-10-22 15:47:13.803553+00', '2025-10-22 15:47:13.803553+00'), ('6e30909a-21a4-4c09-b0de-1a270dd8c00e', 'Doctor', 'Octopus', 'dococ@gmail.com', 'true', '2025-11-02 22:46:52.584521+00', '2025-11-02 22:46:52.584521+00'), ('7a39483e-8c18-40d5-a979-f9184e54e2ea', 'Melody', 'Yu', 'melodyyucoupons@gmail.com', 'true', '2025-10-22 00:56:59.11747+00', '2025-10-22 00:56:59.11747+00'), ('80adde9b-1f13-4920-b0b3-6851160403de', 'Melody', 'Yu', 'melody.yu@gmail.com', 'true', '2025-10-27 01:55:19.294195+00', '2025-10-27 01:55:19.294195+00'), ('8c682d62-3787-464f-a30c-39ee21a0e559', 'Test', 'Therapist', 'test.therapist@example.com', 'true', '2025-09-23 15:36:21.14454+00', '2025-09-23 15:36:21.14454+00'), ('9dad94d8-6534-4510-90d7-e4e97c175a65', 'John', 'Doe', 'johndoe@gmail.com', 'true', '2025-09-09 00:16:01.274923+00', '2025-09-09 00:16:01.274923+00'), ('a1b2c3d4-e5f6-47a8-9abc-1234567890ab', 'Sarah', 'Mitchell', 'sarah.mitchell@wellnesscenter.org', 'true', '2025-10-05 20:50:02.298175+00', '2025-10-05 20:50:02.298175+00'), ('b2c3d4e5-f6a7-48b9-8acd-2345678901bc', 'James', 'Lee', 'james.lee@wellnesscenter.org', 'true', '2025-10-05 20:50:02.298175+00', '2025-10-05 20:50:02.298175+00'), ('c3d4e5f6-a7b8-49ca-9bde-3456789012cd', 'Lena', 'Thompson', 'lena.thompson@wellnesscenter.org', 'true', '2025-10-05 20:50:02.298175+00', '2025-10-05 20:50:02.298175+00'), ('d4e5f6a7-b8c9-4adb-8cef-4567890123de', 'Robert', 'Garcia', 'robert.garcia@wellnesscenter.org', 'false', '2025-10-05 20:50:02.298175+00', '2025-10-05 20:50:02.298175+00');
INSERT INTO "public"."student" ("id", "first_name", "last_name", "therapist_id", "grade", "dob", "iep", "created_at", "updated_at") VALUES ('00e0be7f-2ccf-4380-b0d3-9d1b20d958cb', 'JO', 'CC', '6e30909a-21a4-4c09-b0de-1a270dd8c00e', '4', null, 'false', '2025-11-02 22:48:32.615158+00', '2025-11-02 22:59:45.344531+00'), ('0711034b-18b9-4f41-9b61-467ce9a373d5', 'Will', 'Doe', '9dad94d8-6534-4510-90d7-e4e97c175a65', '5', '2010-05-19', 'Active IEP with speech therapy goals', '2025-09-15 19:32:10.374254+00', '2025-10-09 00:30:43.82858+00'), ('0dd85cce-7de4-415d-8cb1-aac30dfaad61', 'Sierra', 'Welsch', '9dad94d8-6534-4510-90d7-e4e97c175a65', '4', '2025-10-11', 'love special standard', '2025-10-17 00:32:36.341704+00', '2025-10-17 00:32:36.341704+00'), ('11111111-1111-1111-1111-111111111111', 'Emily', 'Nguyen', 'a1b2c3d4-e5f6-47a8-9abc-1234567890ab', '3', '2016-04-12', 'Has mild speech delay', '2025-10-05 20:50:02.298175+00', '2025-10-09 00:30:40.686398+00'), ('14ddfb78-cc6e-48a8-9a0d-38040ae1fd88', 'Jo', 'Park', '9dad94d8-6534-4510-90d7-e4e97c175a65', '1', '2025-11-02', null, '2025-11-02 22:47:56.278359+00', '2025-11-02 22:47:56.278359+00'), ('1558c810-2bc5-4d76-81bf-e4c1fcfb76e0', 'kaamil ', 'thobai', '9dad94d8-6534-4510-90d7-e4e97c175a65', '0', '1904-01-01', 'special', '2025-10-17 00:43:49.821763+00', '2025-10-17 00:43:49.821763+00'), ('177a6ebd-cc6e-4593-b74a-6004786e08a4', 'Stone', 'Liu', '8c682d62-3787-464f-a30c-39ee21a0e559', '11', '2003-09-30', 'Active IEP with speech therapy goals', '2025-09-25 00:03:35.499319+00', '2025-10-09 00:30:38.892632+00'), ('187d6473-5859-4a30-922d-623d92ec6a04', 'Gary', 'Graduated', '9dad94d8-6534-4510-90d7-e4e97c175a65', '-1', '2002-05-02', 'Speech therapy ', '2025-10-16 20:32:40.819439+00', '2025-10-16 20:33:09.885229+00'), ('1999081f-b51d-446a-bd2d-78cf4d70ebd8', 'John', 'Deer', '9dad94d8-6534-4510-90d7-e4e97c175a65', '6', '2025-10-13', 'yuppe', '2025-10-14 00:19:35.622921+00', '2025-10-14 00:19:35.622921+00'), ('22222222-2222-2222-2222-222222222222', 'Noah', 'Ramirez', 'a1b2c3d4-e5f6-47a8-9abc-1234567890ab', '4', '2015-09-08', 'Working on emotional regulation', '2025-10-05 20:50:02.298175+00', '2025-10-09 00:30:36.907891+00'), ('33333333-3333-3333-3333-333333333333', 'Ava', 'Patel', 'b2c3d4e5-f6a7-48b9-8acd-2345678901bc', '5', '2014-11-23', 'Focus improvement plan', '2025-10-05 20:50:02.298175+00', '2025-10-09 00:30:33.510538+00'), ('44444444-4444-4444-4444-444444444444', 'Liam', 'Johnson', 'b2c3d4e5-f6a7-48b9-8acd-2345678901bc', '3', '2016-01-15', 'Social confidence development', '2025-10-05 20:50:02.298175+00', '2025-10-09 00:30:31.400626+00'), ('55555555-5555-5555-5555-555555555555', 'Sophia', 'Kim', 'c3d4e5f6-a7b8-49ca-9bde-3456789012cd', '2', '2017-07-19', '["Test goal"]', '2025-10-05 20:50:02.298175+00', '2025-11-03 01:03:36.367835+00'), ('58c4249c-b34a-4036-88e3-69e349a1f7e1', 'Kyra', 'Holmes', '9dad94d8-6534-4510-90d7-e4e97c175a65', '1', '2025-10-01', 'LALALLALALALLALALA', '2025-10-16 23:59:40.47665+00', '2025-10-16 23:59:40.47665+00'), ('632e8368-976a-46fb-8216-4428e4f2bc28', 'Matthias', 'Fellesien', '9dad94d8-6534-4510-90d7-e4e97c175a65', '0', '2003-12-17', 'sw dev diff', '2025-10-17 00:08:54.906411+00', '2025-10-17 00:08:54.906411+00'), ('637d67d6-e8a2-436d-8569-3f66e3e28ab1', 'John', 'Jack', '9dad94d8-6534-4510-90d7-e4e97c175a65', '5', '2010-05-15', '["Active IEP with speech therapy goals","This is a goal","This is another goal"]', '2025-09-15 19:19:28.398065+00', '2025-11-02 22:47:43.555267+00'), ('66666666-6666-6666-6666-666666666666', 'Ethan', 'Davis', 'd4e5f6a7-b8c9-4adb-8cef-4567890123de', '5', '2014-09-25', '["This is an IEP goal"]', '2025-10-05 20:50:02.298175+00', '2025-11-02 20:34:07.249979+00'), ('8456e2cb-614c-46cc-bc5f-998292430bc7', 'Zainab', 'Imadulla', '9dad94d8-6534-4510-90d7-e4e97c175a65', '0', '2005-06-16', null, '2025-10-17 00:27:36.948689+00', '2025-10-17 00:27:36.948689+00'), ('89e2d744-eec1-490e-a335-422ce79eae70', 'Grace', 'Uecker', '9dad94d8-6534-4510-90d7-e4e97c175a65', '12', '2004-03-18', null, '2025-10-17 00:38:14.153433+00', '2025-10-17 00:38:14.153433+00'), ('9bd5fa3b-b41b-420b-b708-b02f926d8474', 'Abhik', 'Ray', '8c682d62-3787-464f-a30c-39ee21a0e559', '0', '2010-05-15', 'Active IEP with speech therapy goals', '2025-09-24 23:47:43.391442+00', '2025-10-14 02:23:23.143152+00'), ('9d749cd5-2d48-4395-9b8d-0136fad77d3d', 'Aarav', 'Raina', '9dad94d8-6534-4510-90d7-e4e97c175a65', '0', '2006-05-19', null, '2025-10-17 00:02:09.232494+00', '2025-10-17 00:02:09.232494+00'), ('9f728937-2054-4e1d-a780-6a0ec4b7d648', 'Zahra', 'Wibisana', '9dad94d8-6534-4510-90d7-e4e97c175a65', '10', '2004-10-10', 'Read more books', '2025-10-16 21:58:32.188977+00', '2025-10-16 21:58:32.188977+00'), ('a2c2f464-7835-4699-9b04-236e5cc40321', 'Joe', 'Do', '9dad94d8-6534-4510-90d7-e4e97c175a65', '1', null, null, '2025-11-02 22:39:26.633806+00', '2025-11-02 22:39:26.633806+00'), ('a977691e-0362-46c8-87d8-659783d7b74a', 'vichu', 'wu', '9dad94d8-6534-4510-90d7-e4e97c175a65', '12', '2005-01-04', 'we dumb', '2025-10-17 00:29:35.560325+00', '2025-10-17 00:29:35.560325+00'), ('aa89702f-8981-4a5c-b5b1-c25ad0e38edd', 'Jack', 'Oehling', '9dad94d8-6534-4510-90d7-e4e97c175a65', null, '2001-01-01', 'XYZ', '2025-10-13 22:53:33.576439+00', '2025-10-13 22:53:33.576439+00'), ('c1b13b8b-86d2-4230-95ee-0a572376e962', 'JJJ', 'FFF', '6e30909a-21a4-4c09-b0de-1a270dd8c00e', '1', null, null, '2025-11-02 23:06:13.520517+00', '2025-11-02 23:06:13.520517+00'), ('c95d5b12-6736-4e51-84ee-d13559adda7b', 'Hello', 'Jack', '6e30909a-21a4-4c09-b0de-1a270dd8c00e', '3', '2025-11-07', null, '2025-11-02 23:09:28.691159+00', '2025-11-02 23:09:28.691159+00'), ('cc6e5b95-0e09-4deb-9cc9-f9c2032eebf9', 'Melody', 'Yu', '9dad94d8-6534-4510-90d7-e4e97c175a65', '3', '2004-01-01', 'Nice', '2025-10-13 22:44:32.046827+00', '2025-10-13 22:44:32.046827+00'), ('cdddf449-a996-4d62-b47d-3df1a1544ae2', 'Kevin', 'Matula', '9dad94d8-6534-4510-90d7-e4e97c175a65', '4', '2025-10-29', 'Kevin', '2025-11-02 15:00:22.049554+00', '2025-11-02 15:00:22.049554+00'), ('e68267e1-655c-437e-8507-a41e58dcce75', 'as', 'sa', '9dad94d8-6534-4510-90d7-e4e97c175a65', '1', '2025-10-16', 'as', '2025-10-17 00:09:24.858926+00', '2025-10-17 00:09:24.858926+00'), ('f6b8308b-f145-43b0-bb1a-c33219dfae23', 'Kevin', 'Matula', '9dad94d8-6534-4510-90d7-e4e97c175a65', '0', '2007-01-01', 'Kid', '2025-10-13 23:14:56.180017+00', '2025-10-13 23:14:56.180017+00');

CREATE TABLE IF NOT EXISTS district (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS school (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  district_id INTEGER NOT NULL REFERENCES district(id),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Add placeholders
INSERT INTO district (name) VALUES ('Generate School District') ON CONFLICT DO NOTHING;
INSERT INTO school (name, district_id) VALUES ('Generate Elementary', 1) ON CONFLICT DO NOTHING;

-- Backfill
ALTER TABLE student
ADD COLUMN school_id INTEGER NOT NULL DEFAULT 1 REFERENCES school(id);

ALTER TABLE therapist 
ADD COLUMN schools INTEGER[],
ADD COLUMN district_id INTEGER NOT NULL DEFAULT 1 REFERENCES district(id);


-- Remove default (used when backfilling)
ALTER TABLE student
ALTER COLUMN school_id DROP DEFAULT;

ALTER TABLE therapist
ALTER COLUMN district_id DROP DEFAULT;

CREATE INDEX idx_student_school ON student(school_id);
CREATE INDEX idx_therapist_schools ON therapist USING GIN (schools);
CREATE INDEX idx_therapist_district ON therapist(district_id);